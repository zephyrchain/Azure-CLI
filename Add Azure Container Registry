# Define variables following the user's naming conventions
RESOURCE_GROUP_NAME="RG-PRODUCTION-PRD-EUS-003"
LOCATION="eastus"
ACR_NAME="acrproductionprdeus001"  # ACR names must be lowercase and alphanumeric
SKU="Premium"  # Options: Basic, Standard, Premium
TAGS='Role="Container Registry" Environment="Production" Type="Production"'

# Create Azure Container Registry
echo "Creating Azure Container Registry $ACR_NAME in resource group $RESOURCE_GROUP_NAME..."
az acr create \
  --name "$ACR_NAME" \
  --resource-group "$RESOURCE_GROUP_NAME" \
  --location "$LOCATION" \
  --sku "$SKU" \
  --tags $TAGS \
  --admin-enabled true  # Enable admin user (best practice for initial setup)

# Enable content trust (best practice for security)
echo "Enabling content trust for $ACR_NAME..."
az acr config content-trust update \
  --registry "$ACR_NAME" \
  --resource-group "$RESOURCE_GROUP_NAME" \
  --status enabled

# Enable retention policy (best practice for managing storage)
echo "Configuring retention policy for $ACR_NAME..."
az acr config retention update \
  --registry "$ACR_NAME" \
  --resource-group "$RESOURCE_GROUP_NAME" \
  --status enabled \
  --days 30 \
  --type UntaggedManifests

echo "Azure Container Registry $ACR_NAME has been created successfully with best practices configuration."
